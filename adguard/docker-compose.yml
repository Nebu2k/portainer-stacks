services:
  adguardhome:
    image: adguard/adguardhome:latest
    container_name: adguardhome
    restart: unless-stopped
    ports:
      # DNS Ports (REQUIRED - f端r alle Clients im LAN)
      - "53:53/tcp"
      - "53:53/udp"
      
      # Web UI (REQUIRED - f端r Admin-Zugriff)
      # Port 80 intern (nach Setup), 8080 extern
      - "8080:80/tcp"
      
      # Optional: DNS-over-TLS (f端r externe Clients/Mobile)
      # - "853:853/tcp"
      
      # Optional: DNS-over-HTTPS (f端r externe Clients)
      # - "443:443/tcp"
      # - "443:443/udp"
    
    volumes:
      - /data/adguard/workdir:/opt/adguardhome/work
      - /data/adguard/confdir:/opt/adguardhome/conf
    
    labels:
      homepage.group: DNS
      homepage.name: AdGuard Home (Pi4)
      homepage.icon: adguard-home.png
      homepage.href: https://adguard.elmstreet79.de
      homepage.description: DNS Ad Blocker
      homepage.weight: 30
      homepage.widget.type: adguard
      homepage.widget.url: https://adguard.elmstreet79.de
      homepage.widget.username: ${ADGUARD_USERNAME}
      homepage.widget.password: ${ADGUARD_PASSWORD}
    
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:80/login.html || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  adguardhome-sync:
    image: ghcr.io/bakito/adguardhome-sync:latest
    container_name: adguardhome-sync
    restart: unless-stopped
    command: run --config /config/adguardhome-sync.yaml
    
    ports:
      # Sync API/Web UI
      - "8081:8080/tcp"
    
    volumes:
      - /data/adguard-sync/adguardhome-sync.yaml:/config/adguardhome-sync.yaml:ro
    
    depends_on:
      adguardhome:
        condition: service_healthy
